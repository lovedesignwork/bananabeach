# Agent Integration Prompt

**Use this prompt when setting up a new booking website that needs Stripe payments and OneBooking sync.**

---

## Prompt for AI Agent

```
You are setting up a booking website that needs to:
1. Accept payments via Stripe
2. Sync all confirmed bookings to the OneBooking Central Dashboard
3. Display a professional booking confirmation page

IMPORTANT: Before starting any implementation, you MUST read the integration documentation files in order. These contain critical setup instructions, code examples, and troubleshooting guides.

## Required Reading (Read in Order)

Read these files from the `docs/integration/` folder:

1. **01-STRIPE_WEBHOOK.md** - How to configure Stripe webhook endpoint
2. **02-ENVIRONMENT_VARIABLES.md** - All required environment variables
3. **03-DATABASE_SETUP.md** - Database schema and migrations (including booking_ref auto-generation)
4. **04-WEBHOOK_HANDLER.md** - Stripe webhook handler implementation
5. **05-ONEBOOKING_SYNC.md** - OneBooking sync library code
6. **06-SUCCESS_PAGE.md** - Checkout success page design and code
7. **07-PAYMENT_FLOW.md** - Complete payment flow architecture
8. **08-TESTING_CHECKLIST.md** - Pre-deployment testing checklist
9. **09-TROUBLESHOOTING.md** - Common issues and solutions

## Key Implementation Steps

After reading the documentation:

1. Set up all environment variables (see 02-ENVIRONMENT_VARIABLES.md)
2. Run database migrations (see 03-DATABASE_SETUP.md)
3. Implement the Stripe webhook handler (see 04-WEBHOOK_HANDLER.md)
4. Add the OneBooking sync library (see 05-ONEBOOKING_SYNC.md)
5. Create the checkout success page (see 06-SUCCESS_PAGE.md)
6. Configure Stripe webhook in Stripe Dashboard (see 01-STRIPE_WEBHOOK.md)
7. Test the complete flow (see 08-TESTING_CHECKLIST.md)

## Critical Notes

- The booking_ref is auto-generated by a database trigger - do NOT try to generate it in code
- The success page requires BOTH booking_ref AND payment_intent for security
- OneBooking sync happens in the webhook handler AFTER payment confirmation
- Always use the service role key for server-side Supabase operations

## Customization Required

Update these for your specific project:
- Booking reference prefix (e.g., 'SR' for SkyRock, 'FH' for Flying Hanuman)
- Brand colors in success page
- Business name and address in success page
- Contact email and phone
- Important information bullet points

## Reference Implementation

The Flying Hanuman project is a complete reference implementation. You can examine these files:
- /app/api/webhooks/stripe/route.ts
- /lib/onebooking/sync.ts
- /app/(public)/checkout/success/page.tsx
- /app/api/bookings/[ref]/route.ts
- /app/api/checkout/create-payment-intent/route.ts
```

---

## Quick Start Checklist

For the AI agent to verify setup is complete:

- [ ] Read all 9 integration docs
- [ ] Environment variables configured
- [ ] Database tables created
- [ ] Booking ref trigger active
- [ ] Webhook handler implemented
- [ ] OneBooking sync library added
- [ ] Success page created
- [ ] Stripe webhook configured in dashboard
- [ ] Test payment successful
- [ ] Booking synced to OneBooking

---

## File Locations

```
docs/
├── INTEGRATION_GUIDE.md          # Overview and table of contents
├── AGENT_INTEGRATION_PROMPT.md   # This file - prompt for AI agents
└── integration/
    ├── 01-STRIPE_WEBHOOK.md      # Stripe webhook setup
    ├── 02-ENVIRONMENT_VARIABLES.md # All env vars needed
    ├── 03-DATABASE_SETUP.md      # Database schema & triggers
    ├── 04-WEBHOOK_HANDLER.md     # Webhook handler code
    ├── 05-ONEBOOKING_SYNC.md     # OneBooking sync library
    ├── 06-SUCCESS_PAGE.md        # Success page design
    ├── 07-PAYMENT_FLOW.md        # Payment flow architecture
    ├── 08-TESTING_CHECKLIST.md   # Testing checklist
    └── 09-TROUBLESHOOTING.md     # Common issues & fixes
```
